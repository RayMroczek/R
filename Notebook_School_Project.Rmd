---
title: "XX School Scale Score Analysis"
subtitle: "Learning Gains and Losses for 3rd and 3rd graders (2019 and 2020*)"
author: "Rayanne Mroczek (No. 32 Consulting)"
date: "March 10, 2019"
output: html_document
self_contained: no
---

---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 


```{r setup, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE, comment=NA}
#install.packages("knitr")
library(knitr)
knitr::opts_chunk$set(comment=NA, message=FALSE, echo=TRUE, warning=FALSE, 
                      error=FALSE,
                      fig.align='center')
# Set R output width to render nicely
options(width=80)
```
Installing needed packages for analysis:
```{r}
#SS= Scale Score
install.packages("tidyverse")
install.packages("readxl")

library(tidyverse)
library(readxl)
```

Importing and subsetting data:
```{r}
#data import and merging

Student_Roster_2020 <- read_excel("Student_Roster (1).xls")
View(Student_Roster_2020)

Student_Roster_2019 <- read_excel("Student_Roster (2).xls")
View(Student_Roster_2019)

#IDs do not match for the same students over time, so we'll need to make a new one.
#concatenate first name, middle initial, and last name, creating a unique identifier:

Student_Roster_2019$id2 <- paste(Student_Roster_2019$`First Name`,Student_Roster_2019$MI,Student_Roster_2019$`Last Name`,sep="_")

Student_Roster_2020$id2 <- paste(Student_Roster_2020$`First Name`,Student_Roster_2020$MI,Student_Roster_2020$`Last Name`,sep="_")


overlap_2019 <- Student_Roster_2020$id2
reduced_2019 <- Student_Roster_2019[Student_Roster_2019$id2 %in% overlap_2019, ]
overlap_2020 <- reduced_2019$id2
reduced_2020 <- Student_Roster_2020[Student_Roster_2020$id2 %in% overlap_2020,]

all(reduced_2019$id2 %in% reduced_2020$id2)

#add rows to the bottom of the first data file, if all rows align that should align.
combined <- rbind(reduced_2019, reduced_2020)

#replace wierd characters in column names with dots, and some other tidy things
names(combined) <- make.names(names(combined), unique=TRUE)
#remove dots in column names
names(combined) <- gsub("\\.", "", names(combined))
```

Selecting certain columns of interest (after fixing column names):
```{r}
#select only certain columns of interest:
combined_filtered <- combined %>% select(id2,AdminYear, Grade, SS_Read, SS_Vocab, SS_RdCompst, SS_Math, SS_MathComp, SS_Math_Compst, NP_Read, NP_Vocab, NP_RdComp, NP_Math, NP_MathComp, NP_Math_Compst)

```
#next steps will be:
#1. The goal here is to explore the variables we isolated.
#2. Next section will be figuring out how we want to measure/display change by grade.
#3. Final section will be summarizing.
```{r}
#I like to create aggregate tables to look at values across subgroups, but I'd like to check on missing values first. Let's figure out how to do that!

#the syntax below shows summary of NAs:
NA_table <- combined_filtered %>%
  group_by(combined_filtered$AdminYear, combined_filtered$Grade) %>%
  select(everything()) %>%  # replace to your needs
  summarise_all(funs(sum(is.na(.))))

NA_table


# NA is in 2020.
#different ways of checking NA's across - this one says apply the function onto all columns in the data set. interesting, potentially useful for other functions.
map(combined_filtered, ~sum(is.na(.)))

#is it the same person missing 2020 grade 4 data? yes, it's one person, missing reading.
Whos_missing <- combined_filtered %>%
  filter(combined_filtered$Grade=="04" & combined_filtered$AdminYear=="2020" & is.na(combined_filtered$SS_Vocab))
```
Reshaping Data to create certain kinds of plots:
```{r}
#reshaping this data -- make it long - right now one var is long and the others are wide (test type). Then you might be able to make it wide the way you'd like.
#variables that you'd like to gather need to be the same type.

#you can select certain columns to transform.
combined_filtered_recode <- combined_filtered
combined_filtered_recode[,4:15] <- sapply(combined_filtered_recode[,4:15],as.numeric)
```
Do a few summary stats to complement the detailed graphs:
```{r}
Key_Stats <- combined_filtered_recode %>% # define the data we want to aggregate, pass it on
  filter(!is.na(Score))%>%
  group_by(AdminYear, Grade, Test) %>%
                  summarize(n_students = length(unique(id2)),
                          median = median(Score),
                          mean = mean(Score),
                          min = min(Score),
                          max = max(Score),
                          percentile_25th = quantile(Score, 0.25),
                          percentile_50th = quantile(Score, 0.5),
                          percentile_75th = quantile(Score, 0.75)
                    )

View(Key_Stats)
write.csv(Key_Stats,"Key_Stats.csv", row.names = FALSE)

 
```

long to longer transformation:
```{r}
combined_filtered_recode <- combined_filtered_recode %>%
  pivot_longer(!id2:Grade, names_to = "Test", values_to = "Score")
```
Now I need to make the dataset wide, so I can create certain kinds of graphs.
```{r}

#creating two data sets for grade 3 and 6 before transforming, so that I only have one reference column (id2). This will allow me to create some different charts and more easily measure growth, although I bet there's a better way to deal with time series data.

#selecting only rows for each grade across both years.
combined_grade6 <- combined_filtered_recode %>%
  filter(Grade=="05" | Grade=="07")

combined_grade3 <- combined_filtered_recode %>%
  filter(Grade=="02" | Grade=="04")

#dropping the grade column.
combined_grade6 <- select(combined_grade6,id2,AdminYear, Test, Score)
combined_grade3 <- select(combined_grade3,id2,AdminYear, Test, Score)

#transforming long to wide.
combined_grade6 <- combined_grade6 %>%
  pivot_wider(names_from = c(Test, AdminYear), values_from = "Score")

combined_grade3 <- combined_grade3 %>%
  pivot_wider(names_from = c(Test, AdminYear), values_from = "Score")


combined_grade3$Student_ID <- seq.int(nrow(combined_grade3))
combined_grade6$Student_ID <- seq.int(nrow(combined_grade6))


```

There are 13 observations in Grade 6 and 18 observations in Grade 3. The next section will create variables for differences across time and then plot those differences.

```{r}
#creating some extra vars that show differences across time.
combined_grade3$Read_diff<- combined_grade3$SS_Read_2020 - combined_grade3$SS_Read_2019 
combined_grade3$Vocab_diff<- combined_grade3$SS_Vocab_2020 - combined_grade3$SS_Vocab_2019
combined_grade3$Rd_Compst_diff<- combined_grade3$SS_RdCompst_2020 - combined_grade3$SS_RdCompst_2019
combined_grade3$Math_diff<- combined_grade3$SS_Math_2020 - combined_grade3$SS_Math_2019
combined_grade3$Math_Comp_diff<- combined_grade3$SS_MathComp_2020 - combined_grade3$SS_MathComp_2019
combined_grade3$Math_Compst_diff<- combined_grade3$SS_Math_Compst_2020 - combined_grade3$SS_Math_Compst_2019


combined_grade6$Read_diff<- combined_grade6$SS_Read_2020 - combined_grade6$SS_Read_2019 
combined_grade6$Vocab_diff<- combined_grade6$SS_Vocab_2020 - combined_grade6$SS_Vocab_2019
combined_grade6$Rd_Compst_diff<- combined_grade6$SS_RdCompst_2020 - combined_grade6$SS_RdCompst_2019
combined_grade6$Math_diff<- combined_grade6$SS_Math_2020 - combined_grade6$SS_Math_2019
combined_grade6$Math_Comp_diff<- combined_grade6$SS_MathComp_2020 - combined_grade6$SS_MathComp_2019
combined_grade6$Math_Compst_diff<- combined_grade6$SS_Math_Compst_2020 - combined_grade6$SS_Math_Compst_2019

#____________________________________________________________________________
#3rd Grade Reading - Difference graphs
combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$Read_diff)])

change_Reading_3rd <- ggplot(combined_grade3)+
  aes(x=Student_ID, y=Read_diff)+
  geom_bar(stat="identity", width=.8, fill = "#a5cee1")+
  coord_cartesian(ylim = c(-75, 150)) + 
  labs(title = "Reading Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 3rd Grade Test Scores (Fall Testing) and 2019 2nd Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Reading_3rd
change_Reading_3rd<-change_Reading_3rd + theme(legend.position = "none")

png("change_Reading_3rd.png", width = 800, height = 500)
plot(change_Reading_3rd)
dev.off()

#3rd Grade Vocab
combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$Vocab_diff)])

change_Vocab_3rd <- ggplot(combined_grade3)+
  aes(x=Student_ID, y=Vocab_diff)+
  geom_bar(stat="identity", width=.8, fill = "#2a79b4")+
  coord_cartesian(ylim = c(-75, 150)) + 
  labs(title = "Vocab Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 3rd Grade Test Scores (Fall Testing) and 2019 2nd Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Vocab_3rd
change_Vocab_3rd<-change_Vocab_3rd + theme(legend.position = "none")

png("change_Vocab_3rd.png", width = 800, height = 500)
plot(change_Vocab_3rd)
dev.off()

#___
combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$Math_diff)])

change_Math_3rd <- ggplot(combined_grade3)+
  aes(x=Student_ID, y=Math_diff)+
  geom_bar(stat="identity", width=.8, fill = "#ade18e")+
   coord_cartesian(ylim = c(-75, 150)) + 
  labs(title = "Math Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 3rd Grade Test Scores (Fall Testing) and 2019 2nd Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Math_3rd
change_Math_3rd<-change_Math_3rd + theme(legend.position = "none")

png("change_Math_3rd.png", width = 800, height = 500)
plot(change_Math_3rd)
dev.off()

#______
combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$Math_Comp_diff)])

change_Math_Comp_3rd <- ggplot(combined_grade3)+
  aes(x=Student_ID, y=Math_Comp_diff)+
  geom_bar(stat="identity", width=.8, fill = "#3fa525")+
  coord_cartesian(ylim = c(-75, 150)) + 
  labs(title = "Math Computation Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 3rd Grade Test Scores (Fall Testing) and 2019 2nd Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Math_Comp_3rd
change_Math_Comp_3rd<-change_Math_Comp_3rd + theme(legend.position = "none")

png("change_Math_Comp_3rd.png", width = 800, height = 500)
plot(change_Math_Comp_3rd)
dev.off()

#_______
#______6th

#____________________________________________________________________________
#6th Grade Reading
combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$Read_diff)])

change_Reading_6th <- ggplot(combined_grade6)+
  aes(x=Student_ID, y=Read_diff)+
  geom_bar(stat="identity", width=.8, fill = "#a5cee1")+
  coord_cartesian(ylim = c(-50, 75)) + 
  labs(title = "Reading Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 6th Grade Test Scores (Fall Testing) and 2019 5th Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Reading_6th
change_Reading_6th<-change_Reading_6th + theme(legend.position = "none")

png("change_Reading_6th.png", width = 800, height = 500)
plot(change_Reading_6th)
dev.off()

#6th Grade Vocab
combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$Vocab_diff)])

change_Vocab_6th <- ggplot(combined_grade6)+
  aes(x=Student_ID, y=Vocab_diff)+
  geom_bar(stat="identity", width=.8, fill = "#2a79b4")+
  coord_cartesian(ylim = c(-50, 75)) + 
  labs(title = "Vocab Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 6th Grade Test Scores (Fall Testing) and 2019 5th Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Vocab_6th
change_Vocab_6th<-change_Vocab_6th + theme(legend.position = "none")

png("change_Vocab_6th.png", width = 800, height = 500)
plot(change_Vocab_6th)
dev.off()

#___
combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$Math_diff)])

change_Math_6th <- ggplot(combined_grade6)+
  aes(x=Student_ID, y=Math_diff)+
  geom_bar(stat="identity", width=.8, fill = "#ade18e")+
   coord_cartesian(ylim = c(-50, 75)) + 
  labs(title = "Math Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 6th Grade Test Scores (Fall Testing) and 2019 5th Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Math_6th
change_Math_6th<-change_Math_6th + theme(legend.position = "none")

png("change_Math_6th.png", width = 800, height = 500)
plot(change_Math_6th)
dev.off()

#______
combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$Math_Comp_diff)])

change_Math_Comp_6th <- ggplot(combined_grade6)+
  aes(x=Student_ID, y=Math_Comp_diff)+
  geom_bar(stat="identity", width=.8, fill = "#3fa525")+
  coord_cartesian(ylim = c(-50, 75)) + 
  labs(title = "Math Computation Scale Score Change, 2019 to 2020*", subtitle = "*Difference Between 2020 6th Grade Test Scores (Fall Testing) and 2019 5th Grade Test Scores", y = "Score Change", x = "Student ID")+
  theme_bw()

change_Math_Comp_6th
change_Math_Comp_6th<-change_Math_Comp_6th + theme(legend.position = "none")

png("change_Math_Comp_6th.png", width = 800, height = 500)
plot(change_Math_Comp_6th)
dev.off()

```


```{r}

#different graphs, experimenting
scores_6th <- ggplot(combined_filtered_recode[(combined_filtered_recode$Grade=="05" | combined_filtered_recode$Grade=="07")& (combined_filtered_recode$Test=="SS_Read" | combined_filtered_recode$Test=="SS_Vocab" | combined_filtered_recode$Test=="SS_Math" | combined_filtered_recode$Test=="SS_MathComp"),])+
  aes(x=Score, fill=AdminYear)+
  geom_density(alpha=0.3)+
  facet_wrap(~Test, nrow=2)+
  scale_fill_brewer(palette="Paired")+
  labs(title = "Comparing Same-Student Scores: 2019 to 2020*", subtitle = "*Comparing Scores on 5th Grade test (taken Spring 2019) to 6th Grade test (taken Fall 2020)", y = "Count", x = "Scale Score")+
  #geom_density(alpha=0.3)+
  theme_bw()

#_____________________________________
scores_6th <- ggplot(combined_filtered_recode[(combined_filtered_recode$Grade=="05" | combined_filtered_recode$Grade=="07") & (combined_filtered_recode$Test=="SS_Read" | combined_filtered_recode$Test=="SS_Vocab" | combined_filtered_recode$Test=="SS_Math" | combined_filtered_recode$Test=="SS_MathComp"),])+
  aes(x=Score, fill=Test)+
  geom_boxplot()+
  facet_wrap(~AdminYear, ncol=2)+
  scale_fill_brewer(palette="Paired")+
  labs(title = "Comparing Same-Student Scores: 2019 to 2020*", subtitle = "*Comparing Scores on 5th Grade test (taken Spring 2019) to 6th Grade test (taken Fall 2020)", y = "Count", x = "Scale Score")+
  #geom_density(alpha=0.3)+
  theme_bw()

scores_6th

#density of change across tests




#________
png("Histogram_6th.png", width = 800, height = 500)
plot(scores_6th)
dev.off()

scores_6th <- ggplot(combined_filtered_recode[combined_filtered_recode$AdminYear=="2020" & combined_filtered_recode$Grade=="07" & (combined_filtered_recode$Test=="SS_Read" | combined_filtered_recode$Test=="SS_Vocab" | combined_filtered_recode$Test=="SS_Math" | combined_filtered_recode$Test=="SS_MathComp"),])+
  aes(x=Score, fill=Test)+
  geom_histogram()+
  facet_wrap(~Test, nrow=2)+
  scale_fill_brewer(palette="Paired")+
  labs(title = "2020 3rd* Grade Scale Scores Across Tests", subtitle = "*Tests taken in Fall 2020 by 7th Graders", y = "Count", x = "Scale Score")+
  #geom_density(alpha=0.3)+
  theme_bw()

png("Histogram_6th.png", width = 800, height = 500)
plot(scores_6th)
dev.off()




scores_3rd
```

Barbell Graphs:
```{r}

#Each graph needs to be downloaded as a PNG. 
#orca and processx packages are for exporting plotly graphs.
#orca needs to be installed in system Path.
if (!require("processx")) install.packages("processx")
if (!require("plotly")) install.packages("plotly")
library(processx)
library(plotly)

#this will only work if each row is unique.
combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_Read_2019)])
combined_grade3$SS_Read_2019
Reading_3rd <- plot_ly(combined_grade3, color = I("gray80"))
Reading_3rd <- Reading_3rd %>% add_segments(x = ~SS_Read_2019, xend = ~SS_Read_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Reading_3rd <- Reading_3rd %>% add_markers(x = ~SS_Read_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Reading_3rd <- Reading_3rd %>% add_markers(x = ~SS_Read_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Reading_3rd <- Reading_3rd %>% layout(
    title = "Reading Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "Reading Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Reading_3rd


combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_Vocab_2019)])
combined_grade3$SS_Vocab_2019
Vocab_3rd <- plot_ly(combined_grade3, color = I("gray80"))
Vocab_3rd <- Vocab_3rd %>% add_segments(x = ~SS_Vocab_2019, xend = ~SS_Vocab_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Vocab_3rd <- Vocab_3rd %>% add_markers(x = ~SS_Vocab_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Vocab_3rd <- Vocab_3rd %>% add_markers(x = ~SS_Vocab_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Vocab_3rd <- Vocab_3rd %>% layout(
    title = "Vocab Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "Vocab Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Vocab_3rd


combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_RdCompst_2019)])

RdCompst_3rd <- plot_ly(combined_grade3, color = I("gray80"))
RdCompst_3rd <- RdCompst_3rd %>% add_segments(x = ~SS_RdCompst_2019, xend = ~SS_RdCompst_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
RdCompst_3rd <- RdCompst_3rd %>% add_markers(x = ~SS_RdCompst_2019, y = ~Student_ID, name = "2019", color = I("gray"))
RdCompst_3rd <- RdCompst_3rd %>% add_markers(x = ~SS_RdCompst_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
RdCompst_3rd <- RdCompst_3rd %>% layout(
    title = "Reading Compst. Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "RdCompst Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

RdCompst_3rd


combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_Math_2019)])

Math_3rd <- plot_ly(combined_grade3, color = I("gray80"))
Math_3rd <- Math_3rd %>% add_segments(x = ~SS_Math_2019, xend = ~SS_Math_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Math_3rd <- Math_3rd %>% add_markers(x = ~SS_Math_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Math_3rd <- Math_3rd %>% add_markers(x = ~SS_Math_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Math_3rd <- Math_3rd %>% layout(
    title = "Math Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "Math Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Math_3rd


combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_MathComp_2019)])

MathComp_3rd <- plot_ly(combined_grade3, color = I("gray80"))
MathComp_3rd <- MathComp_3rd %>% add_segments(x = ~SS_MathComp_2019, xend = ~SS_MathComp_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
MathComp_3rd <- MathComp_3rd %>% add_markers(x = ~SS_MathComp_2019, y = ~Student_ID, name = "2019", color = I("gray"))
MathComp_3rd <- MathComp_3rd %>% add_markers(x = ~SS_MathComp_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
MathComp_3rd <- MathComp_3rd %>% layout(
    title = "Math Computation Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "MathComp Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

MathComp_3rd


combined_grade3$Student_ID <- factor(combined_grade3$Student_ID, levels = combined_grade3$Student_ID[order(combined_grade3$SS_Math_Compst_2019)])

Math_Compst_3rd <- plot_ly(combined_grade3, color = I("gray80"))
Math_Compst_3rd <- Math_Compst_3rd %>% add_segments(x = ~SS_Math_Compst_2019, xend = ~SS_Math_Compst_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Math_Compst_3rd <- Math_Compst_3rd %>% add_markers(x = ~SS_Math_Compst_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Math_Compst_3rd <- Math_Compst_3rd %>% add_markers(x = ~SS_Math_Compst_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Math_Compst_3rd <- Math_Compst_3rd %>% layout(
    title = "Math Composite Scale Scores: 2nd to 3rd* grade",
    xaxis = list(title = "Math_Compst Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Math_Compst_3rd

orca(Reading_3rd, "Reading_3rd.png")
orca(Vocab_3rd, "Vocab_3rd.png")
orca(RdCompst_3rd, "RdCompst_3rd.png")
orca(Math_3rd, "Math_3rd.png")
orca(MathComp_3rd, "MathComp_3rd.png")
orca(Math_Compst_3rd, "Math_Compst_3rd.png")

```


```{r}

#6th grade dumbell graphs
combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_Read_2019)])
combined_grade6$SS_Read_2019
Reading_6th <- plot_ly(combined_grade6, color = I("gray80"))
Reading_6th <- Reading_6th %>% add_segments(x = ~SS_Read_2019, xend = ~SS_Read_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Reading_6th <- Reading_6th %>% add_markers(x = ~SS_Read_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Reading_6th <- Reading_6th %>% add_markers(x = ~SS_Read_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Reading_6th <- Reading_6th %>% layout(
    title = "Reading Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "Reading Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Reading_6th


combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_Vocab_2019)])
combined_grade6$SS_Vocab_2019
Vocab_6th <- plot_ly(combined_grade6, color = I("gray80"))
Vocab_6th <- Vocab_6th %>% add_segments(x = ~SS_Vocab_2019, xend = ~SS_Vocab_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Vocab_6th <- Vocab_6th %>% add_markers(x = ~SS_Vocab_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Vocab_6th <- Vocab_6th %>% add_markers(x = ~SS_Vocab_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Vocab_6th <- Vocab_6th %>% layout(
    title = "Vocab Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "Vocab Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Vocab_6th


combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_RdCompst_2019)])

RdCompst_6th <- plot_ly(combined_grade6, color = I("gray80"))
RdCompst_6th <- RdCompst_6th %>% add_segments(x = ~SS_RdCompst_2019, xend = ~SS_RdCompst_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
RdCompst_6th <- RdCompst_6th %>% add_markers(x = ~SS_RdCompst_2019, y = ~Student_ID, name = "2019", color = I("gray"))
RdCompst_6th <- RdCompst_6th %>% add_markers(x = ~SS_RdCompst_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
RdCompst_6th <- RdCompst_6th %>% layout(
    title = "Reading Compst. Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "RdCompst Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

RdCompst_6th


combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_Math_2019)])

Math_6th <- plot_ly(combined_grade6, color = I("gray80"))
Math_6th <- Math_6th %>% add_segments(x = ~SS_Math_2019, xend = ~SS_Math_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Math_6th <- Math_6th %>% add_markers(x = ~SS_Math_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Math_6th <- Math_6th %>% add_markers(x = ~SS_Math_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Math_6th <- Math_6th %>% layout(
    title = "Math Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "Math Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Math_6th


combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_MathComp_2019)])

MathComp_6th <- plot_ly(combined_grade6, color = I("gray80"))
MathComp_6th <- MathComp_6th %>% add_segments(x = ~SS_MathComp_2019, xend = ~SS_MathComp_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
MathComp_6th <- MathComp_6th %>% add_markers(x = ~SS_MathComp_2019, y = ~Student_ID, name = "2019", color = I("gray"))
MathComp_6th <- MathComp_6th %>% add_markers(x = ~SS_MathComp_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
MathComp_6th <- MathComp_6th %>% layout(
    title = "Math Computation Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "MathComp Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

MathComp_6th


combined_grade6$Student_ID <- factor(combined_grade6$Student_ID, levels = combined_grade6$Student_ID[order(combined_grade6$SS_Math_Compst_2019)])

Math_Compst_6th <- plot_ly(combined_grade6, color = I("gray80"))
Math_Compst_6th <- Math_Compst_6th %>% add_segments(x = ~SS_Math_Compst_2019, xend = ~SS_Math_Compst_2020, y = ~Student_ID, yend = ~Student_ID, showlegend = FALSE)
Math_Compst_6th <- Math_Compst_6th %>% add_markers(x = ~SS_Math_Compst_2019, y = ~Student_ID, name = "2019", color = I("gray"))
Math_Compst_6th <- Math_Compst_6th %>% add_markers(x = ~SS_Math_Compst_2020, y = ~Student_ID, name = "2020", color = I("coral3"))
Math_Compst_6th <- Math_Compst_6th %>% layout(
    title = "Math Composite Scale Scores: 5th to 6th* grade",
    xaxis = list(title = "Math_Compst Scale Score"),
    margin = list(l = 65),
    theme_minimal()
  )

Math_Compst_6th

orca(Reading_6th, "Reading_6th.png")
orca(Vocab_6th, "Vocab_6th.png")
orca(RdCompst_6th, "RdCompst_6th.png")
orca(Math_6th, "Math_6th.png")
orca(MathComp_6th, "MathComp_6th.png")
orca(Math_Compst_6th, "Math_Compst_6th.png")

```

```{r}

combined_6th_long <- select(combined_grade6, Student_ID, id2, Read_diff, Vocab_diff, Math_diff, Math_Comp_diff)
combined_3rd_long <- select(combined_grade3, Student_ID, id2, Read_diff, Vocab_diff, Math_diff, Math_Comp_diff)

#order it before transforming
combined_6th_long<- combined_6th_long[order(Math_Comp_diff),]
combined_3rd_long<- combined_3rd_long[order(Math_diff),]


combined_6th_long <- combined_6th_long %>%
  pivot_longer(!Student_ID:id2, names_to = "Test", values_to = "Difference")

combined_3rd_long <- combined_3rd_long %>%
  pivot_longer(!Student_ID:id2, names_to = "Test", values_to = "Difference")


same_student_6th<-ggplot(combined_6th_long, aes(fill=Test, y=Difference, x=Student_ID)) + 
    geom_bar(position="dodge", stat="identity", width =.5)+
    labs(title = "Differences in Test Scores: 5th to 6th* Grade", subtitle = "2020 vs.2019 Scores (2020 scores from testing in Fall 2020)", x = "Student ID", caption = "*Note:If a column is missing for a student, it means that student had insufficient data for calculations.", fill = "Test" )+
   scale_fill_manual(values = c( "#3fa525","#ade18e", "#a8d1e5", "#2b78b6"))


same_student_3rd<-ggplot(combined_3rd_long, aes(fill=Test, y=Difference, x=Student_ID)) + 
    geom_bar(position="dodge", stat="identity", width =.5)+
    labs(title = "Differences in Test Scores: 2nd to 3rd* Grade", subtitle = "2020 vs.2019 Scores (2020 scores from testing in Fall 2020)", x = "Student ID", caption = "*Note:If a column is missing for a student, it means that student had insufficient data for calculations.", fill = "Test" )+
   scale_fill_manual(values = c( "#3fa525","#ade18e", "#a8d1e5", "#2b78b6"))


same_student_6th
same_student_3rd
png("same_student_6th.png", width = 900, height = 500)
plot(same_student_6th)
dev.off()

same_student_3rd
png("same_student_3rd.png", width = 900, height = 500)
plot(same_student_3rd)
dev.off()

```

```{r}
write.csv(combined_filtered_recode,"Long_format_myrtle.csv", row.names = FALSE)

#creating reference files

combined_grade3_reference<-select(combined_grade3,Student_ID, id2)
combined_grade6_reference<-select(combined_grade6,Student_ID, id2)

write.csv(combined_grade3_reference,"combined_grade3_reference.csv", row.names = FALSE)
write.csv(combined_grade6_reference,"combined_grade6_reference.csv", row.names = FALSE)


combined_reference_full<-select(Student_Roster_2020, id2, Grade)
write.csv(combined_reference_full,"combined_reference_full.csv", row.names = FALSE)

```
Now I'd like to create density plots of scores across student groups, based on 2020 scores, and when the students enrolled in school.
For 4th grade, this is only two groups. For 7th grade, the teacher provided several codes (different enrollment years).
One person needs to be dropped (from 7th grade) - teacher's request.

```{r}
Student_Roster_2020_full <- read_excel("Student_Roster (1).xls")
View(Student_Roster_2020_full)

Student_Roster_2020_full$id2 <- paste(Student_Roster_2020_full$`First Name`,Student_Roster_2020_full$MI,Student_Roster_2020_full$`Last Name`,sep="_")
length(unique(Student_Roster_2020_full$id2))
#there are 74 unique rows, and there are 74 rows (before dropping one).

returning_roster <- read_excel("returning_roster.xlsx")
Summary(returning_roster)

summary(returning_roster$id2)
summary(Student_Roster_2020_full$id2)

#we don't need student name and grade, so I'll drop those.
returning_roster = subset(returning_roster, select = -c(Grade,`Student Name`) )
View(returning_roster)

returning_2020 <- left_join(Student_Roster_2020_full, returning_roster, by = "id2")

View(returning_2020)
summary(returning_2020$new_stud)

returning_2020$new_stud <- as.factor(returning_2020$new_stud)
returning_2020$new_stud <- as.numeric(returning_2020$new_stud)
returning_2020$new_stud2 <- returning_2020$new_stud
returning_2020$new_stud2 <- ifelse((returning_2020$new_stud == "Y"), "New Student", "Previously Enrolled")
View(returning_2020)

names(returning_2020) <- make.names(names(returning_2020), unique=TRUE)
#remove dots in column names
names(returning_2020) <- gsub("\\.", "", names(returning_2020))


cat.names <- c("SS_Read", "SS_Vocab", "SS_RdCompst", "SS_Math", "SS_MathComp", "SS_Math_Compst")
print(cat.names)
returning_2020[,cat.names] = data.frame(apply(returning_2020[cat.names], 2, as.numeric))

returning_2020_1drop <- returning_2020 %>%
filter(returning_2020$new_stud != "DROP")

rm(plot_4_reading)
plot_4_reading <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade=="04" & !is.na(returning_2020_1drop$SS_Read),])+
  aes(x=SS_Read, fill=new_stud)+
  geom_density(alpha=0.3)+
  theme_bw()

plot_4_reading
```

new box plot graphs - 4th grade
```{r}
#thoughts on graph - it's helpful but I want to know more about how many are in each group. A bar graph with dots might be more helpful. I've done this before...

#the following creates median values for all values grouped a certain way - we can then apply this to the graphs. I'm not going to use this however.
#library(plyr)
#Read_meds <- ddply(returning_2020_1drop, .(new_stud), summarise, med = median(SS_Read))

Reading_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_Read) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Reading Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Reading Score")+
  coord_flip()

Reading_4th

Vocab_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_Vocab) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Vocab Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Vocab Score")+
  coord_flip()

RdCompst_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_RdCompst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Reading Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Reading Composite Score")+
  coord_flip()

Math_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_Math) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Math Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Score")+
  coord_flip()

MathComp_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_MathComp) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Math Computation Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Computation Score")+
  coord_flip()

Math_Compst_4th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("04"),]) + # that match these
  aes(x = new_stud2, y = SS_Math_Compst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "4th Grade: Math Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Composite Score")+
  coord_flip()
```

new box plots - 7th grade
```{r}
Reading_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_Read) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Reading Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Reading Score")+
  coord_flip()

Reading_7th

Vocab_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_Vocab) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Vocab Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Vocab Score")+
  coord_flip()

RdCompst_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_RdCompst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Reading Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Reading Composite Score")+
  coord_flip()

Math_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_Math) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Score")+
  coord_flip()

MathComp_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_MathComp) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Computation Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Computation Score")+
  coord_flip()

Math_Compst_7th <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = new_stud2, y = SS_Math_Compst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Composite Score")+
  coord_flip()
```

new box plots, 7th - more groupings
```{r}

Reading_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_Read) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Reading Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Reading Score")+
  coord_flip()

Vocab_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_Vocab) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Vocab Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Vocab Score")+
  coord_flip()

RdCompst_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_RdCompst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Reading Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Reading Composite Score")+
  coord_flip()

Math_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_Math) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", x = "Student Enrollment Status", y = "Math Score")+
  coord_flip()

MathComp_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_MathComp) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Computation Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled",x =  "Student Enrollment Status", y = "Math Computation Score")+
  coord_flip()

Math_Compst_7th_mult <- ggplot(returning_2020_1drop[returning_2020_1drop$Grade %in%  # This command says include only values below
                c("07"),]) + # that match these
  aes(x = newstud_detail, y = SS_Math_Compst) +
  # Hide outliers in boxplot
  geom_boxplot(alpha = 0.1, outlier.shape = 1, 
               color = I("red")) +
   # Let's make a faint boxplot
  geom_point(alpha = 1) + 
  theme_bw() +
  labs(title = "7th Grade: Math Composite Scores", subtitle = "By Newly Enrolled vs. Previously Enrolled", "Student Enrollment Status", y = "Math Composite Score")+
  coord_flip()
```

exporting
```{r}
setwd("C:/Users/mrocz/OneDrive/Documents/freelance work/Myrtle/graphs")

png("Reading_4th.png", width = 800, height = 500)
plot(Reading_4th)
dev.off()

png("Vocab_4th.png", width = 800, height = 500)
plot(Vocab_4th)
dev.off()

png("RdCompst_4th.png", width = 800, height = 500)
plot(RdCompst_4th)
dev.off()

png("Math_4th.png", width = 800, height = 500)
plot(Math_4th)
dev.off()

png("MathComp_4th.png", width = 800, height = 500)
plot(MathComp_4th)
dev.off()

png("Math_Compst_4th.png", width = 800, height = 500)
plot(Math_Compst_4th)
dev.off()

#7th grade

png("Reading_7th.png", width = 800, height = 500)
plot(Reading_7th)
dev.off()

png("Vocab_7th.png", width = 800, height = 500)
plot(Vocab_7th)
dev.off()

png("RdCompst_7th.png", width = 800, height = 500)
plot(RdCompst_7th)
dev.off()

png("Math_7th.png", width = 800, height = 500)
plot(Math_7th)
dev.off()

png("MathComp_7th.png", width = 800, height = 500)
plot(MathComp_7th)
dev.off()

png("Math_Compst_7th.png", width = 800, height = 500)
plot(Math_Compst_7th)
dev.off()

#7th_mult grade, more cats
MathComp_7th_mult
png("Reading_7th_mult.png", width = 800, height = 500)
plot(Reading_7th_mult)
dev.off()

png("Vocab_7th_mult.png", width = 800, height = 500)
plot(Vocab_7th_mult)
dev.off()

png("RdCompst_7th_mult.png", width = 800, height = 500)
plot(RdCompst_7th_mult)
dev.off()

png("Math_7th_mult.png", width = 800, height = 500)
plot(Math_7th_mult)
dev.off()

png("MathComp_7th_mult.png", width = 800, height = 500)
plot(MathComp_7th_mult)
dev.off()

png("Math_Compst_7th_mult.png", width = 800, height = 500)
plot(Math_Compst_7th_mult)
dev.off()
```

Now creating aggregated data (means, medians, mins and maxes) by group and subject
```{r}
library(tidyverse)
library(dplyr)


Aggregate_stats <- returning_2020_1drop %>% # define the data we want to aggregate, pass it on
  group_by(Grade, new_stud2) %>%
                  summarize(n_students = length(id2))

  
  
Aggregate_stats <- returning_2020_1drop %>%
 group_by(Grade, new_stud2) %>%
                  summarize(n_students = length(id2),
                            Reading_mean = mean(SS_Read, na.rm=TRUE),
                            Vocab_mean = mean(SS_Vocab, na.rm=TRUE),
                            Math_mean = mean(SS_Math, na.rm=TRUE),
                            Math_Comp_mean = mean(SS_MathComp, na.rm=TRUE),
                            Reading_median = median(SS_Read, na.rm=TRUE),
                            Vocab_median = median(SS_Vocab, na.rm=TRUE),
                            Math_median = median(SS_Math, na.rm=TRUE),
                            Math_Comp_median = median(SS_MathComp, na.rm=TRUE),  
                            Reading_min = min(SS_Read, na.rm=TRUE),
                            Vocab_min = min(SS_Vocab, na.rm=TRUE),
                            Math_min = min(SS_Math, na.rm=TRUE),
                            Math_Comp_min = min(SS_MathComp, na.rm=TRUE),  
                            Reading_max = max(SS_Read, na.rm=TRUE),
                            Vocab_max = max(SS_Vocab, na.rm=TRUE),
                            Math_max = max(SS_Math, na.rm=TRUE),
                            Math_Comp_max = max(SS_MathComp, na.rm=TRUE),  
                            )

View(Aggregate_stats)

write.csv(Aggregate_stats,"aggregate_stats.csv", row.names = FALSE)


```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
